<script type="module" src="auth.js"></script> ```

### 2. родро┐ро░рпБродрпНродрокрпНрокроЯрпНроЯ роЗро▒рпБродро┐ `index.html` роХрпБро▒ро┐ропрпАроЯрпБ:

родропро╡рпБроЪрпЖропрпНродрпБ роЗроирпНродроХрпН роХрпБро▒ро┐ропрпАроЯрпНроЯрпИ роЙроЩрпНроХро│рпН **`index.html`** роХрпЛрокрпНрокро┐ро▓рпН роТроЯрпНроЯро┐, роХрооро┐роЯрпН роЪрпЖропрпНрод рокро┐ро▒роХрпБ, **"роЪро░ро┐ (Ok)"** роОройрпНро▒рпБ роЪрпКро▓рпНро▓рпБроЩрпНроХро│рпН.

```html
<!DOCTYPE html>
<html lang="ta">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>роиро╛ройрпН роХро╡ро┐родрпИ - Kavithai & Web3 Platform</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Tamil:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    
    <link rel="stylesheet" href="styles.css"> 

    <script type="module" src="script.js"></script> 
    <script type="module" src="search.js"></script> 
    <script type="module" src="comments.js"></script> 
    
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
        import { getAuth, GoogleAuthProvider, signInWithPopup, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
        import { getFirestore, doc, getDoc, setDoc, serverTimestamp, updateDoc } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

        // --- Firebase Configuration (Your Details) ---
        const firebaseConfig = {
            apiKey: "AIzaSyA4hpYehoJphOMZXMEjqxpPoVm8DUNX4jo", // Verify
            authDomain: "naankavithai-web.firebaseapp.com",    // Verify
            projectId: "naankavithai-web",                     // Verify
            appId: "1:1009851243193:web:197f9b77a51d3c6851d968"
        };
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app); 
        const db = getFirestore(app); 
        const provider = new GoogleAuthProvider();

        // Import necessary functions from other modules (Must use window object if not exporting)
        import { executeSearchQuery } from "./search.js"; 
        
        // --- 1. CORE AUTH FUNCTIONS (DEFINED LOCALLY) ---
        
        // Auth Setup Profile (Required for new users)
        async function setupUserProfile(user) {
            const userRef = doc(db, "users", user.uid);
            const docSnap = await getDoc(userRef);
            if (!docSnap.exists()) {
                await setDoc(userRef, {
                    uid: user.uid, email: user.email, displayName: user.displayName || 'роХро╡ро┐роЮро░рпН',
                    dateJoined: serverTimestamp(), role: 'basic', earnings: 0, postCount: 0
                });
            } else {
                await updateDoc(userRef, { lastLogin: serverTimestamp() });
            }
        }

        // Login Function
        window.signInWithGoogle = async function() {
            try {
                const result = await signInWithPopup(auth, provider);
                await setupUserProfile(result.user);
                window.showToastNotification(`роЙро│рпНроирпБро┤рпИро╡рпБ ро╡рпЖро▒рпНро▒ро┐!`, 'success');
            } catch (error) {
                console.error("Google Sign-In Error:", error.code);
                window.showToastNotification("роЙро│рпНроирпБро┤рпИро╡ро┐ро▓рпН рокро┐ро┤рпИ роПро▒рпНрокроЯрпНроЯродрпБ.", 'error');
            }
        };

        // Signout Function
        window.signOutUser = async function() {
            try {
                await signOut(auth);
                window.showToastNotification("ро╡рпЖро▒рпНро▒ро┐роХро░рооро╛роХ ро╡рпЖро│ро┐ропрпЗро▒ро┐ройрпАро░рпНроХро│рпН.", 'info');
            } catch (error) {
                window.showToastNotification("ро╡рпЖро│ро┐ропрпЗро▒рпБро╡родро┐ро▓рпН рокро┐ро┤рпИ роПро▒рпНрокроЯрпНроЯродрпБ.", 'error');
            }
        };

        // --- 2. DATA LOADING & UI SWITCHING ---

        async function loadHomepagePoems() {
            const listElement = document.getElementById('homepage-poem-list');
            if (!listElement) return;

            // Kill Switch Logic (for completeness)
            const killSwitchActive = localStorage.getItem('killSwitch') === 'active';
            if (killSwitchActive) {
                listElement.innerHTML = '<div style="text-align:center; padding: 50px; color: var(--error-color); font-size: 1.2em;">тЫФ родро│родрпНродрпИ роиро┐ро░рпНро╡ро╛роХро┐ родро▒рпНроХро╛ро▓ро┐роХрооро╛роХ роиро┐ро▒рпБродрпНродро┐ропрпБро│рпНро│ро╛ро░рпН.</div>';
                return;
            }
            
            listElement.innerHTML = '<p style="text-align:center; padding: 20px;"><i class="fas fa-spinner fa-spin"></i> роХро╡ро┐родрпИроХро│рпН роПро▒рпНро▒рокрпНрокроЯрпБроХро┐ройрпНро▒рой...</p>';
            
            // Query Firestore for latest 10 approved poems 
            // NOTE: This relies on executeSearchQuery being stable.
            const latestPoems = await executeSearchQuery("", { sort: 'date-desc', theme: 'all', geo: 'global', token: 'none' }, 10); 

            listElement.innerHTML = '';

            if (latestPoems.length === 0) {
                listElement.innerHTML = '<p style="text-align:center; color:#777;">роТрокрпНрокрпБродро▓рпН роЕро│ро┐роХрпНроХрокрпНрокроЯрпНроЯ роХро╡ро┐родрпИроХро│рпН роОродрпБро╡рпБроорпН роЗро▓рпНро▓рпИ. роиро┐ро░рпНро╡ро╛роХро┐ роТрокрпНрокрпБродро▓рпБроХрпНроХро╛роХроХрпН роХро╛родрпНродро┐ро░рпБроХрпНроХро╡рпБроорпН.</p>';
                return;
            }

             latestPoems.forEach(poem => {
                // ... (Poem card rendering logic - uses global functions like togglePoemDetails) ...
                const card = document.createElement('div');
                card.className = 'poem-card'; 
                card.id = `poem-${poem.id}`;
                
                const avgRating = poem.averageRating ? poem.averageRating.toFixed(1) : 'N/A';
                const likes = poem.likes || 0;
                const postDate = poem.timestamp ? new Date(poem.timestamp.toDate()).toLocaleDateString('ta-IN') : 'N/A';
                
                const isTokenGated = poem.isTokenGated || false;
                const contentSummary = isTokenGated ? 'роЙро│рпНро│роЯроХрпНроХроорпН рокрпВроЯрпНроЯрокрпНрокроЯрпНроЯрпБро│рпНро│родрпБ. роЯрпЛроХрпНроХройрпН роорпВро▓роорпН родро┐ро▒роХрпНроХро╡рпБроорпН.' : (poem.content ? poem.content.substring(0, 150) : 'роЙро│рпНро│роЯроХрпНроХроорпН роЗро▓рпНро▓рпИ') + '...';
                const unlockButton = isTokenGated ? `<button onclick="window.location.href='web3'" class="buy-btn" style="background-color: var(--warning-color); margin-left: 10px;">Token-роЗро▓рпН родро┐ро▒</button>` : '';

                card.innerHTML = `
                    <div class="poem-summary">
                        <h3>${poem.title} ${unlockButton}</h3>
                        <p>${contentSummary}</p>
                        <div class="poem-meta" style="font-size: 0.9em; color:#777;">
                            роЖроЪро┐ро░ро┐ропро░рпН: <a href="profile?uid=${poem.authorId}" style="color:var(--secondary-color);">${poem.authorName || 'роЕро▒ро┐ропрокрпНрокроЯро╛родро╡ро░рпН'}</a> | рокродро┐ро╡ро┐роЯрпНроЯ роиро╛ро│рпН: ${postDate}
                        </div>
                    </div>

                    <div class="action-bar">
                        <div>
                            <span class="rating" style="color:var(--warning-color);"><i class="fas fa-star"></i> ${avgRating}</span>
                            <span class="likes" style="color:var(--primary-color); margin-left: 15px;"><i class="fas fa-heart"></i> ${likes}</span>
                        </div>
                        <button onclick="togglePoemDetails('${poem.id}', ${isTokenGated})" data-expanded="false" class="approve-btn" style="float: right;">
                            <i class="fas fa-chevron-down"></i> роорпЗро▓рпБроорпН роХро╛рогрпНроХ
                        </button>
                    </div>

                    <div id="details-${poem.id}" class="full-details-section" style="display:none; margin-top: 20px; padding-top: 20px;">
                        <pre>${poem.content}</pre>
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; border-top: 1px dashed var(--border-color); padding-top: 15px;">
                            <div>
                                <button onclick="window.realTimeTranslate(document.querySelector('#details-${poem.id} pre').textContent, 'en')" class="approve-btn" style="background-color: #3498db; margin-right: 15px;"><i class="fas fa-language"></i> роЖроЩрпНроХро┐ро▓родрпНродро┐ро▓рпН ро╡ро╛роЪро┐роХрпНроХ</button>
                                <span>роЙроЩрпНроХро│рпН роородро┐рокрпНрокрпАроЯрпБ:</span>
                                <i class="fas fa-star rating-star" data-poem-id="${poem.id}" data-value="1" onclick="ratePoem(1, '${poem.id}')"></i>
                                <i class="fas fa-star rating-star" data-poem-id="${poem.id}" data-value="2" onclick="ratePoem(2, '${poem.id}')"></i>
                                <i class="fas fa-star rating-star" data-poem-id="${poem.id}" data-value="3" onclick="ratePoem(3, '${poem.id}')"></i>
                                <i class="fas fa-star rating-star" data-poem-id="${poem.id}" data-value="4" onclick="ratePoem(4, '${poem.id}')"></i>
                                <i class="fas fa-star rating-star" data-poem-id="${poem.id}" data-value="5" onclick="ratePoem(5, '${poem.id}')"></i>
                            </div>
                            <div>
                                <button onclick="handleReaction('like', '${poem.id}')" class="approve-btn" style="background-color: var(--primary-color);"><i class="fas fa-heart"></i> рокро┐роЯро┐роХрпНроХрпБроорпН</button>
                                <button onclick="toggleBookmark('${poem.id}')" class="approve-btn" style="background-color: #999;"><i class="fas fa-bookmark"></i> роЪрпЗрооро┐</button>
                            </div>
                        </div>
                        <div class="comments-section">
                            <h4>ЁЯЧгя╕П роХро░рпБродрпНродрпБроХрпНроХро│рпН (<span id="comment-count-${poem.id}">0</span>)</h4>
                            <textarea id="comment-input-${poem.id}" placeholder="роХро░рпБродрпНродрпИ роЙро│рпНро│ро┐роЯро╡рпБроорпН..." style="width:100%; margin-bottom: 10px;"></textarea>
                            <button class="comment-post-btn" onclick="postComment('${poem.id}', document.getElementById('comment-input-${poem.id}').value)">роХро░рпБродрпНродрпБ роЗроЯрпБроХ</button>
                            <div id="comments-list-${poem.id}" style="margin-top: 15px;">
                                <p style="text-align:center; font-style:italic;">роХро░рпБродрпНродрпБроХро│рпН роПро▒рпНро▒рокрпНрокроЯрпБроХро┐ройрпНро▒рой...</p>
                            </div>
                        </div>
                    </div>
                `;
                listElement.appendChild(card);
            });
        }

        // --- 3. UI SWITCHING LOGIC (Must be defined globally) ---
        
        window.togglePoemDetails = function(poemId, isTokenGated) {
            // Logic relies on global functions like canAccessTokenGatedContent
            if (isTokenGated) { /* Simplified check */ return; } 
            
            const detailsEl = document.getElementById(`details-${poemId}`);
            const button = document.querySelector(`#poem-${poemId} button`);

            if (detailsEl.style.display === 'none' || detailsEl.style.display === '') {
                detailsEl.style.display = 'block';
                button.innerHTML = '<i class="fas fa-chevron-up"></i> роЪрпБро░рпБроХрпНроХрпБроХ';
                window.loadComments(poemId); 
            } else {
                detailsEl.style.display = 'none';
                button.innerHTML = '<i class="fas fa-chevron-down"></i> роорпЗро▓рпБроорпН роХро╛рогрпНроХ';
            }
        };

        // 4. AUTH STATE LISTENER (CRITICAL FOR UI SWITCHING)
        onAuthStateChanged(auth, async (user) => {
            const loginSection = document.getElementById('login-section');
            const userProfileSection = document.getElementById('user-profile-section');
            const userNameDisplay = document.getElementById('user-name');
            const navCreatePoem = document.getElementById('nav-create-poem');
            const navAdmin = document.getElementById('nav-admin');
            
            if (user) {
                // Fetch User Data for Role Check
                const userDocSnap = await getDoc(doc(db, "users", user.uid));
                const userData = userDocSnap.data();

                // UI SWITCHING
                if (loginSection) loginSection.style.display = 'none';
                if (userProfileSection) userProfileSection.style.display = 'flex'; 
                if (userNameDisplay) userNameDisplay.textContent = user.displayName || user.email;
                if (navCreatePoem) navCreatePoem.style.display = 'block';

                const isAdmin = user.email === 'naankavithaiweb@gmail.com' || userData?.role === 'admin';
                
                if (isAdmin) { 
                    if (navAdmin) navAdmin.style.display = 'block';
                } else {
                    if (navAdmin) navAdmin.style.display = 'none';
                }
            } else {
                // LOGGED OUT STATE
                if (loginSection) loginSection.style.display = 'block';
                if (userProfileSection) userProfileSection.style.display = 'none';
                if (navCreatePoem) navCreatePoem.style.display = 'none';
                if (navAdmin) navAdmin.style.display = 'none';
            }
            // Load poems after UI update
            loadHomepagePoems();
        });
    </script>
</head>
<body>

    <header>
        <div class="header-content">
            <h1>роиро╛ройрпН роХро╡ро┐родрпИ</h1>
            <p>родрооро┐ро┤ро┐ро▓рпН роХро╡ро┐родрпИроХро│рпН, Web3 & AI-ройрпН роЪроЩрпНроХроороорпН</p>
        </div>
        
        <nav>
            <a href="index.html">роорпБроХрокрпНрокрпБ (Feed)</a>
            <a id="nav-create-poem" href="create" style="display:none;"> 
                <i class="fas fa-feather-alt"></i> роХро╡ро┐родрпИ роЙро░рпБро╡ро╛роХрпНроХрпБ
            </a>
            <a href="forum">роЪроорпВроХроорпН (Forum)</a>
            <a href="monetization">роЪроирпНродро╛ (Premium)</a>
            <a id="nav-admin" href="admin" class="admin-link" style="display:none;">
                <i class="fas fa-cog"></i> роиро┐ро░рпНро╡ро╛роХроорпН
            </a>
            <a href="settings">роЕроорпИрокрпНрокрпБроХро│рпН</a>
        </nav>

        <div id="auth-container">
            <div id="login-section">
                <button onclick="signInWithGoogle()" class="google-sign-in-btn">
                    <i class="fab fa-google"></i> Google/Gmail роЙро│рпНроирпБро┤рпИро╡рпБ
                </button>
                <a href="web3" class="wallet-login-btn">
                    <i class="fas fa-wallet"></i> External Wallet Login (Web3)
                </a>
            </div>

            <div id="user-profile-section" style="display: none;">
                <span id="user-name-display">
                    <i class="fas fa-user-circle"></i> <span id="user-name"></span> роХрпНроХрпБ роиро▓рпНро╡ро░ро╡рпБ!
                </span>
                <a href="profile" class="profile-btn">роЪрпБропро╡ро┐ро╡ро░роорпН</a>
                <button onclick="signOutUser()" class="signout-btn">ро╡рпЖро│ро┐ропрпЗро▒рпБ</button>
                <i class="fas fa-bell notification-icon"></i> </div>
        </div>
        
    </header>

    <main>
        <div id="site-status-alert" style="display: none; padding: 15px; background-color: var(--error-color); color: white; border-radius: 5px; margin-bottom: 20px; text-align: center;">
             ЁЯЪи роорпБроХрпНроХро┐роп роЕро▒ро┐ро╡ро┐рокрпНрокрпБ: роиро┐ро░рпНро╡ро╛роХро┐ родро│родрпНродрпИ родро▒рпНроХро╛ро▓ро┐роХрооро╛роХ роиро┐ро▒рпБродрпНродро┐ропрпБро│рпНро│ро╛ро░рпН.
        </div>
        
        <h2>роЪроорпАрокродрпНродро┐роп роХро╡ро┐родрпИрокрпН рокродро┐ро╡рпБроХро│рпН</h2>
        <div id="homepage-poem-list">
            <p style="text-align:center; padding: 20px;"><i class="fas fa-spinner fa-spin"></i> роХро╡ро┐родрпИроХро│рпН роПро▒рпНро▒рокрпНрокроЯрпБроХро┐ройрпНро▒рой...</p>
        </div>
        
        <p style="text-align: center; margin-top: 30px;">
            <a href="search" class="approve-btn">ЁЯФО роЕройрпИродрпНродрпБроХрпН роХро╡ро┐родрпИроХро│рпИропрпБроорпН родрпЗроЯрпБ</a>
        </p>
    </main>

    <footer>
        <p class="copyright-text">&copy; 2024 роиро╛ройрпН роХро╡ро┐родрпИ. роЕройрпИродрпНродрпБ роЙро░ро┐роорпИроХро│рпБроорпН рокро╛родрпБроХро╛роХрпНроХрокрпНрокроЯрпНроЯро╡рпИ. | <a href="gdpr">GDPR/родро░ро╡рпБроХрпН роХрпЛро░ро┐роХрпНроХрпИ</a></p>
        
        <div class="contact-icons">
            <a href="mailto:naankavithaiweb@gmail.com" title="рооро┐ройрпНройроЮрпНроЪро▓рпН" class="icon-btn"><i class="fas fa-envelope"></i></a>
            <a href="https://wa.me/94752351754" target="_blank" title="ро╡ро╛роЯрпНро╕рпНроЕрокрпН (Mobile)" class="icon-btn"><i class="fab fa-whatsapp"></i></a>
            <a href="tel:+94752351754" title="роорпКрокрпИро▓рпН роЕро┤рпИрокрпНрокрпБ" class="icon-btn"><i class="fas fa-phone"></i></a>
            <a href="https://t.me/Mohammed_Sahan_1" target="_blank" title="роЯрпЖро▓ро┐роХро┐ро░ро╛роорпН ID" class="icon-btn"><i class="fab fa-telegram-plane"></i></a>
            <a href="https://t.me/Naan_kavithai" target="_blank" title="роЯрпЖро▓ро┐роХро┐ро░ро╛роорпН роЪрпЗройро▓рпН" class="icon-btn"><i class="fas fa-users"></i></a>
            <a href="https://chat.whatsapp.com/C8BPddhMuTmE2Q0ZA8tIep" target="_blank" title="ро╡ро╛роЯрпНро╕рпНроЕрокрпН роХрпБро┤рпБ" class="icon-btn"><i class="fab fa-whatsapp-square"></i></a>
        </div>
    </footer>

</body>
  </html>
